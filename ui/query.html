---
bindings:
- name:     results
  resource: :/api/collections/{{ qs `id` }}/where/{{ qs `q` }}
  params:
    limit:  '{{ qs `limit` }}'
    offset: '{{ qs `offset` }}'
    sort:   '{{ qs `sort` }}'
    fields: '{{ qs `fields` }}'
---
<div class="container">
    <h3>Results for: {{ qs `q` }}</h3>
    <h6 class="mb-4">{{ thousandify .bindings.results.result_count }} records</h6>

    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Fields</th>
            </tr>
        </thead>
        <tbody>
        {{ range $record := .bindings.results.records }}
            <tr>
                <td>{{ $record.id }}</td>
                <td>
                    <dl class="row">
                    {{ range $k, $v := $record.fields }}
                        <dt class="col-2">{{ $k }}</dt>
                        <dd class="col-10" id="q_{{ $record.id }}_{{ $k }}">
                        {{ if isMap $v }}
                            <script type="text/javascript">
                                $(function(){
                                    var data = JSON.parse({{ jsonify $v }});

                                    $('#q_{{ $record.id }}_{{ $k }}').jsonViewer(data, {
                                        collapsed: true,
                                    });
                                });
                            </script>
                        {{ else }}
                            <code>{{ $v }}</code>
                        {{ end }}
                        </dd>
                    {{ end }}
                    </dl>
                </td>
            </tr>
        {{ end }}
        </tbody>
    </table>
</div>
